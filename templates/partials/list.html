{{ define "list" }}
    {{ with .Data }}
        {{ $Args := .Args}}
        {{ $Resource := .Resource}}
        {{ $List := .List}}
        {{ $Item := .Item}}

        {{ $DirSize := bitsForHumans .List.Size }}

        <!-- File browser card -->
        <div class="bg-base-200/40 rounded-2xl border border-w-line/50 overflow-hidden mb-3">

            <!-- Breadcrumbs -->
            <div class="flex items-center justify-between gap-2 px-4 py-3 border-b border-w-line/50 text-sm">
                <div class="min-w-0 truncate flex items-center gap-1">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4 text-w-muted shrink-0">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12.75V12A2.25 2.25 0 0 1 4.5 9.75h15A2.25 2.25 0 0 1 21.75 12v.75m-8.69-6.44-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z" />
                    </svg>
                    <span class="truncate">
                    {{ range makeBreadcrumbs .List.ListItem.PathStr }}
                        {{ if .Active }}
                            <span class="text-w-sub font-medium">/ {{ .Name }}</span>
                        {{ else if $Args.File }}
                            <span class="hover:text-w-purpleL transition-colors">/ <a href="/{{ $Resource.ID }}?pwd={{ .PathStr }}{{ if $Args.File }}&file={{ $Args.File }}{{ end }}" data-async-target="#list" data-async-layout="async_list">{{ .Name }}</a></span>
                        {{ else }}
                            <span class="hover:text-w-purpleL transition-colors">/ <a href="/{{ $Resource.ID }}?pwd={{ .PathStr }}" data-async-target="main">{{ .Name }}</a></span>
                        {{ end }}
                    {{ end }}
                    </span>
                </div>
                {{ with makeDirDownload $ . }}
                <form class="{{ .Action }}" action="{{ .Endpoint }}" method="post" enctype="multipart/form-data" data-async-target="#log-{{ .ID }}" data-async-push-state="false">
                    <input type="hidden" name="resource-id" value="{{ .ResourceID }}" />
                    <input type="hidden" name="item-id" value="{{ .ItemID }}" />
                    <button type="submit" class="btn btn-sm btn-ghost border border-w-line text-w-sub hover:border-w-pink hover:text-base-content whitespace-nowrap" data-umami-event="{{ .Action }}" onclick="document.getElementById('progress-modal-{{ .ID }}').showModal()">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" />
                        </svg>
                        ZIP [{{ $DirSize }}]
                    </button>
                </form>
                {{ end }}
            </div>

            <!-- File/folder list -->
            <div class="divide-y divide-w-line">
                {{ range .List.Items }}
                    {{ if and ($Args.File) (eq .Type "directory") }}
                        <a href="/{{ $Resource.ID }}?pwd={{ .PathStr }}{{ if $Args.File }}&file={{ $Args.File }}{{ end }}" data-async-target="#list" data-async-layout="async_list"
                           class="flex items-center gap-4 px-4 py-3.5 hover:bg-base-300/30 transition-colors group">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5 text-w-muted shrink-0">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12.75V12A2.25 2.25 0 0 1 4.5 9.75h15A2.25 2.25 0 0 1 21.75 12v.75m-8.69-6.44-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z" />
                            </svg>
                            <span class="text-sm font-medium truncate group-hover:text-w-purpleL transition-colors">{{ .Name }}</span>
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-3.5 h-3.5 text-w-muted/40 shrink-0 ml-auto">
                                <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" />
                            </svg>
                        </a>
                    {{ else if and (not $Args.File) (eq .Type "directory") }}
                        <a href="/{{ $Resource.ID }}?pwd={{ .PathStr }}" data-async-target="main"
                           class="flex items-center gap-4 px-4 py-3.5 hover:bg-base-300/30 transition-colors group">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5 text-w-muted shrink-0">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12.75V12A2.25 2.25 0 0 1 4.5 9.75h15A2.25 2.25 0 0 1 21.75 12v.75m-8.69-6.44-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z" />
                            </svg>
                            <span class="text-sm font-medium truncate group-hover:text-w-purpleL transition-colors">{{ .Name }}</span>
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-3.5 h-3.5 text-w-muted/40 shrink-0 ml-auto">
                                <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" />
                            </svg>
                        </a>
                    {{ else if and ($Item) (eq .PathStr $Item.PathStr) }}
                        <div class="flex items-center gap-4 px-4 py-3.5 bg-base-300/50">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5 text-w-purpleL shrink-0">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" />
                            </svg>
                            <span class="text-sm truncate font-medium text-w-purpleL">{{ .Name }}</span>
                            <span class="text-xs text-w-muted ml-auto shrink-0">{{ bitsForHumans .Size }}</span>
                        </div>
                    {{ else }}
                        <a href="/{{ $Resource.ID }}?pwd={{ $List.ListItem.PathStr }}&file={{ .PathStr }}{{ if not (eq $Args.Page 1) }}&page={{ $Args.Page }}{{ end }}" data-async-target="main"
                           class="flex items-center gap-4 px-4 py-3.5 hover:bg-base-300/30 transition-colors group">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5 text-w-muted shrink-0">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" />
                            </svg>
                            <span class="text-sm font-medium truncate group-hover:text-w-purpleL transition-colors">{{ .Name }}</span>
                            <span class="text-xs text-w-muted/60 ml-auto shrink-0">{{ bitsForHumans .Size }}</span>
                        </a>
                    {{ end }}
                {{ end }}
            </div>

            <!-- Pagination -->
            {{ if .List | hasPagination }}
            <div class="flex items-center gap-1 px-4 py-3 border-t border-w-line/50">
                {{ range makePagination .List .Args.Page .Args.PageSize }}
                {{ if .Active }}
                <a class="btn btn-sm btn-ghost min-w-[2rem]" href="/{{ $Resource.ID }}?pwd={{ $List.ListItem.PathStr }}&page={{ .Page }}{{ if $Args.File }}&file={{ $Args.File }}{{ end }}" data-async-target="#list" data-async-layout="async_list">
                {{ else if .Number }}
                <span class="btn btn-sm min-w-[2rem] bg-base-300/60 text-w-text border-none pointer-events-none">
                {{ else }}
                <span class="btn btn-sm min-w-[2rem] text-w-muted/40 border-none pointer-events-none">
                {{ end }}
                {{ if .Prev }}&larr;{{ end }}
                {{ if .Next }}&rarr;{{ end }}
                {{ if .Number }}{{ .Page }}{{ end }}
                {{ if .Active }}</a>{{ else }}</span>{{ end }}
                {{ end }}
            </div>
            {{ end }}

        </div>

        <dialog id="progress-modal-{{ .List.ID }}" class="modal">
            <div class="modal-box bg-w-card border border-w-line/50 rounded-2xl max-w-3xl" onclick="if(event.target.closest('.closeable-close'))this.closest('dialog').close()">
                <form method="dialog">
                    <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2 text-w-muted hover:text-base-content">âœ•</button>
                </form>
                <h3 class="text-lg font-bold tracking-tight flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5 text-w-cyan">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3" />
                    </svg>
                    Preparing Download
                </h3>
                <div id="log-{{ .List.ID }}" class="mt-4" data-async-layout="{{`{{ template "main" . }}`}}">
                    <div class="flex justify-center py-4">
                        <span class="loading loading-spinner loading-md text-w-cyan"></span>
                    </div>
                </div>
            </div>
            <form method="dialog" class="modal-backdrop">
                <button>close</button>
            </form>
        </dialog>
    {{ end }}
{{ end }}
