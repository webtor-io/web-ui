{{ define "vault/pledge-remove-modal" }}
	{{ if and (.User | hasAuth) .Data.Vault }}
		{{ with .Data }}
			<div id="pledge-remove-form" data-async-layout="{{`{{ template "vault/pledge-remove-modal" . }}`}}">
				{{ if .VaultPledgeRemove }}
					<dialog class="modal" open>
						<div class="modal-box">
							<h3 class="text-2xl font-bold text-accent w-full">Remove Vault Pledge</h3>
							
							{{ if eq .VaultPledgeRemove.Status "success" }}
								<p class="py-4">
									Your pledge has been successfully removed and your Vault Points have been returned to your account. The torrent may be removed from the Vault if it's no longer funded. You can always pledge your points again if needed.
								</p>

								<div class="modal-action justify-center">
									<form method="dialog">
										<button class="btn btn-accent" data-umami-event="vault-pledge-remove-success-confirmed">Got it!</button>
									</form>
								</div>
							{{ else if eq .VaultPledgeRemove.Status "error" }}
								<p class="py-4">
									Unfortunately, your pledge could not be removed due to an error:
								</p>
								{{ if .VaultPledgeRemove.Err }}
									<div class="progress-alert progress-alert-oneline closeable mb-4">
										<pre>{{ .VaultPledgeRemove.Err | log | shortErr }}</pre>
									</div>
								{{ end }}
								<div class="modal-action justify-center">
									<form method="dialog">
										<button class="btn btn-accent" data-umami-event="vault-pledge-remove-error-confirmed">Ok</button>
									</form>
								</div>
							{{ else if .VaultPledgeRemove.Frozen }}
								<p class="py-4">
									Your Vault Points are currently frozen and cannot be removed yet. Please come back later when the freeze period expires.
								</p>

								<div class="modal-action justify-center">
									<form method="dialog">
										<button class="btn btn-accent" data-umami-event="vault-pledge-frozen-acknowledged">Got it!</button>
									</form>
								</div>
							{{ else }}
								<p class="py-4">
									Are you sure you want to remove your pledge for this torrent? This action cannot be undone.
								</p>

								<div class="modal-action justify-center">
									<form action="/vault/pledge/remove" method="post" data-async-target="#pledge-remove-form" data-async-push-state="false">
										<input type="hidden" name="resource_id" value="{{ .Resource.ID }}" />
										<button type="submit" class="btn btn-accent" data-umami-event="vault-pledge-remove-confirmed">
											Remove Pledge
										</button>
									</form>
									<form method="dialog">
										<button class="btn btn-accent btn-outline btn-soft" data-umami-event="vault-pledge-remove-cancelled">Cancel</button>
									</form>
								</div>
							{{ end }}
						</div>
						<form method="dialog" class="modal-backdrop">
							<button>close</button>
						</form>
					</dialog>
				{{ end }}
			</div>
		{{ end }}
	{{ end }}
{{ end }}
